<%- include('partials/header', { title: 'Registro' }) %>

<div class="row">
  <div class="col s12 m8 offset-m2">
    <div class="card">
      <div class="card-content">
        <span class="card-title">Crear cuenta</span>
        <form id="signUpForm">
          <div class="row">
            <div class="input-field col s6"><input id="name" name="name" required><label for="name">Nombre</label></div>
            <div class="input-field col s6"><input id="lastName" name="lastName" required><label for="lastName">Apellido</label></div>
          </div>
          <div class="input-field"><input id="phoneNumber" name="phoneNumber" required><label for="phoneNumber">Teléfono</label></div>
          <div class="input-field"><input id="birthdate" name="birthdate" type="date" required><label for="birthdate">Fecha de nacimiento</label></div>
          <div class="input-field"><input id="email" name="email" type="email" required><label for="email">Correo</label></div>
          <div class="input-field"><input id="password" name="password" type="password" required><label for="password">Contraseña</label>
            <span class="helper-text">Min 8 caracteres, 1 mayúscula, 1 dígito, 1 especial (# $ % & * @)</span>
          </div>
          <button class="btn green" type="submit">Registrar</button>
        </form>
      </div>
      <div class="card-action"><a href="/signIn">Volver a iniciar sesión</a></div>
    </div>
  </div>
</div>

<script>
document.getElementById('signUpForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const form = e.target;
  const body = {
    name: form.name.value.trim(),
    lastName: form.lastName.value.trim(),
    phoneNumber: form.phoneNumber.value.trim(),
    birthdate: new Date(form.birthdate.value).toISOString(),
    email: form.email.value.trim(),
    password: form.password.value
  };
  try {
    const res = await fetch('/api/auth/signUp', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(body)
    });
    const data = await res.json();
    if (!res.ok) return M.toast({html: data.message || 'Error al registrarse', classes:'red'});
    M.toast({html:'Registro exitoso, por favor inicia sesión', classes:'green'});
    location.href = '/signIn';
  } catch (err) {
    console.error(err);
    M.toast({html:'Error en servidor', classes:'red'});
  }
});
</script>

<%- include('partials/footer') %>
